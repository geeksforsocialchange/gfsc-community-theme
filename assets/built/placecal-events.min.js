(()=>{var e,r,t,n,a,s,l,o,c,i,d,p=document.getElementById("placecal-events");function u(e){var t;return e?((t=document.createElement("div")).appendChild(document.createTextNode(e)),t.innerHTML):""}function g(e){return e<10?"0"+e:""+e}function h(e){e=new Date(e);return g(e.getHours())+":"+g(e.getMinutes())}function v(e,t){var r=h(e),t=(t&&(r+=" – "+h(t)),(e=>{try{var t=new Date(e).toLocaleTimeString("en-GB",{timeZoneName:"short"}).split(" ");return t[t.length-1]||""}catch(e){return""}})(e));return t&&(r+=" "+t),r}function m(e){n.hidden="loading"!==e,a.hidden="error"!==e,s.hidden="empty"!==e,l.hidden="events"!==e}function f(e){var o={},r=[],l=(e.forEach(function(e){var t=e.repeatFrequency?e.name:e.name+"||"+h(e.startDate);o[t]||(o[t]=[],r.push(t)),o[t].push(e)}),[]);return r.forEach(function(e){var t=o[e],e=t[0];if(e.repeatFrequency)(e=Object.create(e)).recurrence=e.repeatFrequency.toLowerCase();else if(1<t.length){for(var r=[],n=1;n<t.length;n++){var a=new Date(t[n].startDate)-new Date(t[n-1].startDate);r.push(Math.round(a/864e5))}var s=(e=>{if(0!==e.length){var r={},e=(e.forEach(function(e){r[e]=(r[e]||0)+1}),Number(Object.keys(r).sort(function(e,t){return r[t]-r[e]})[0]));if(1<=e&&e<=2)return"daily";if(6<=e&&e<=8)return"weekly";if(13<=e&&e<=15)return"fortnightly";if(27<=e&&e<=32)return"monthly"}return null})(r);s&&((e=Object.create(e)).recurrence=s)}l.push(e)}),l.sort(function(e,t){return new Date(e.startDate)-new Date(t.startDate)}),l}function y(e){var t,e=f(e),o='<ul class="events__list">';e.forEach(function(e){t=e.startDate;var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][(t=new Date(t)).getDay()]+" "+t.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],r=v(e.startDate,e.endDate),n=(n=e.address)?[n.streetAddress,n.addressLocality,n.postalCode].filter(Boolean).join(", "):"",a=e.publisherUrl||"https://manchester.placecal.org/events/"+e.id,s=new Date(e.startDate).toISOString(),a=(o=(o+='<li class="event"><article class="event__inner">')+('<h2 class="event__title"><a href="'+u(a)+'" target="_blank" rel="noopener noreferrer">'+u(e.name)+"</a></h2>"),u(t)+", "+u(r));e.recurrence&&(a+=" | "+((t=e.recurrence)?"Repeats "+t:"")),o+='<p class="event__time"><time datetime="'+s+'">'+a+"</time></p>",e.description&&(o+='<div class="event__description">'+((r=e.description)?u(r.replace(/\n\s*---[\s\S]*$/,"").replace(/\\([*'_])/g,"$1").replace(/^\s*\[\d+\]:.*$/gm,"").replace(/\[([^\]]+)\]\[\d+\]/g,"$1").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/^\s*https?:\/\/\S+\s*$/gm,"").replace(/^\s*\*\s+/gm,"• ")).split(/\s*\n\s*\n\s*/).filter(function(e){return 0<e.replace(/\s+/g," ").trim().length}).map(function(e){return"<p>"+e.replace(/\n/g,"<br>")+"</p>"}).join(""):"")+"</div>"),e.onlineEventUrl&&(t="Join online",-1!==e.onlineEventUrl.indexOf("meet.google.com")?t="Join on Google Meet":-1!==e.onlineEventUrl.indexOf("discord.com")?t="Join on Discord":-1!==e.onlineEventUrl.indexOf("zoom.us")&&(t="Join on Zoom"),o+='<p class="event__join"><a href="'+u(e.onlineEventUrl)+'" target="_blank" rel="noopener noreferrer">'+t+"</a></p>"),n&&(o+='<p class="event__location">'+u(n)+"</p>"),o+="</article></li>"}),o+='</ul><p class="events__credit">Events feed powered by <a href="https://manchester.placecal.org/partners/geeks-for-social-change" target="_blank" rel="noopener noreferrer">PlaceCal</a></p>',l.innerHTML=o,e=e,(t=p.querySelector('script[type="application/ld+json"]'))&&t.remove(),(t=e.map(function(e){var t=e.publisherUrl||"https://manchester.placecal.org/events/"+e.id,r=e.address&&(e.address.streetAddress||e.address.postalCode),n=!!e.onlineEventUrl,t={"@type":"Event",name:e.name,startDate:e.startDate,eventStatus:"https://schema.org/EventScheduled",organizer:{"@type":"Organization",name:"Geeks for Social Change",url:"https://gfsc.community/"},url:t};return e.endDate&&(t.endDate=e.endDate),e.summary&&(t.description=e.summary),r&&n?(t.eventAttendanceMode="https://schema.org/MixedEventAttendanceMode",t.location=[{"@type":"Place",address:{"@type":"PostalAddress",streetAddress:e.address.streetAddress||"",addressLocality:e.address.addressLocality||"",postalCode:e.address.postalCode||""}},{"@type":"VirtualLocation",url:e.onlineEventUrl}]):n?(t.eventAttendanceMode="https://schema.org/OnlineEventAttendanceMode",t.location={"@type":"VirtualLocation",url:e.onlineEventUrl}):r&&(t.eventAttendanceMode="https://schema.org/OfflineEventAttendanceMode",t.location={"@type":"Place",address:{"@type":"PostalAddress",streetAddress:e.address.streetAddress||"",addressLocality:e.address.addressLocality||"",postalCode:e.address.postalCode||""}}),t})).length&&((e=document.createElement("script")).type="application/ld+json",e.textContent=JSON.stringify({"@context":"https://schema.org","@graph":t}),p.appendChild(e)),m("events")}function D(e){var t;e&&e.length&&(t=new Date((new Date).getTime()+24*r*60*60*1e3),(e=e.filter(function(e){return new Date(e.startDate)<=t})).sort(function(e,t){return new Date(e.startDate)-new Date(t.startDate)}),e.length)?y(e):m("empty")}p&&(e=p.getAttribute("data-placecal-partner-id"),r=parseInt(p.getAttribute("data-placecal-future-days"),10)||90,t=p.getAttribute("data-placecal-endpoint"),n=p.querySelector(".gh-events-loading"),a=p.querySelector(".gh-events-error"),s=p.querySelector(".gh-events-empty"),l=p.querySelector(".gh-events-list"),o="placecal_events_v3_"+(e||"all"),c=18e5,m("loading"),e?(i=(()=>{try{var e,t=localStorage.getItem(o);return t?(e=JSON.parse(t),(new Date).getTime()-e.timestamp>c?(localStorage.removeItem(o),null):e.events):null}catch(e){return null}})())?D(i):(i=t+"?query="+encodeURIComponent("{ partner(id: "+e+") { events { id name summary description startDate endDate repeatFrequency publisherUrl onlineEventUrl onlineEventUrlType address { streetAddress postalCode addressLocality } } } }"),(d=new XMLHttpRequest).open("GET",i,!0),d.onreadystatechange=function(){if(4===d.readyState)if(200!==d.status)m("error");else try{var e=JSON.parse(d.responseText),t=e.data&&e.data.partner&&e.data.partner.events,r=t;try{localStorage.setItem(o,JSON.stringify({timestamp:(new Date).getTime(),events:r}))}catch(e){}D(t)}catch(e){m("error")}},d.onerror=function(){m("error")},d.send()):m("error"))})();//# sourceMappingURL=placecal-events.min.js.map
