(()=>{var e,r,t,n,a,o,l,s,i,c,u=document.getElementById("placecal-events");function p(e){var t;return e?((t=document.createElement("div")).appendChild(document.createTextNode(e)),t.innerHTML):""}function d(e){return e<10?"0"+e:""+e}function g(e){e=new Date(e);return d(e.getHours())+":"+d(e.getMinutes())}function v(e,t){var r=g(e),t=(t&&(r+=" – "+g(t)),(e=>{try{var t=new Date(e).toLocaleTimeString("en-GB",{timeZoneName:"short"}).split(" ");return t[t.length-1]||""}catch(e){return""}})(e));return t&&(r+=" "+t),r}function f(e){n.hidden="loading"!==e,a.hidden="error"!==e,o.hidden="empty"!==e,l.hidden="events"!==e}function h(e){var s={},r=[],l=(e.forEach(function(e){var t=e.repeatFrequency?e.name:e.name+"||"+g(e.startDate);s[t]||(s[t]=[],r.push(t)),s[t].push(e)}),[]);return r.forEach(function(e){var t=s[e],e=t[0];if(e.repeatFrequency)(e=Object.create(e)).recurrence=e.repeatFrequency.toLowerCase();else if(1<t.length){for(var r=[],n=1;n<t.length;n++){var a=new Date(t[n].startDate)-new Date(t[n-1].startDate);r.push(Math.round(a/864e5))}var o=(e=>{if(0!==e.length){var r={},e=(e.forEach(function(e){r[e]=(r[e]||0)+1}),Number(Object.keys(r).sort(function(e,t){return r[t]-r[e]})[0]));if(1<=e&&e<=2)return"daily";if(6<=e&&e<=8)return"weekly";if(13<=e&&e<=15)return"fortnightly";if(27<=e&&e<=32)return"monthly"}return null})(r);o&&((e=Object.create(e)).recurrence=o)}l.push(e)}),l.sort(function(e,t){return new Date(e.startDate)-new Date(t.startDate)}),l}function m(e){var e=h(e),s='<ul class="events__list">';e.forEach(function(e){t=e.startDate;var t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][(t=new Date(t)).getDay()]+" "+t.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],r=v(e.startDate,e.endDate),n=(n=e.address)?[n.streetAddress,n.addressLocality,n.postalCode].filter(Boolean).join(", "):"",a=e.publisherUrl||"https://manchester.placecal.org/events/"+e.id,o=new Date(e.startDate).toISOString(),a=(s=(s+='<li class="event"><article class="event__inner">')+('<h3 class="event__title"><a href="'+p(a)+'" target="_blank" rel="noopener noreferrer">'+p(e.name)+"</a></h3>"),p(t)+", "+p(r));e.recurrence&&(a+=" | "+((t=e.recurrence)?"Repeats "+t:"")),s+='<p class="event__time"><time datetime="'+o+'">'+a+"</time></p>",e.description&&(s+='<div class="event__description">'+((r=e.description)?p(r.replace(/\n\s*---[\s\S]*$/,"").replace(/\\([*'_])/g,"$1").replace(/^\s*\[\d+\]:.*$/gm,"").replace(/\[([^\]]+)\]\[\d+\]/g,"$1").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/^\s*https?:\/\/\S+\s*$/gm,"").replace(/^\s*\*\s+/gm,"• ")).split(/\s*\n\s*\n\s*/).filter(function(e){return 0<e.replace(/\s+/g," ").trim().length}).map(function(e){return"<p>"+e.replace(/\n/g,"<br>")+"</p>"}).join(""):"")+"</div>"),e.onlineEventUrl&&(t="Join online",-1!==e.onlineEventUrl.indexOf("meet.google.com")?t="Join on Google Meet":-1!==e.onlineEventUrl.indexOf("discord.com")?t="Join on Discord":-1!==e.onlineEventUrl.indexOf("zoom.us")&&(t="Join on Zoom"),s+='<p class="event__join"><a href="'+p(e.onlineEventUrl)+'" target="_blank" rel="noopener noreferrer">'+t+"</a></p>"),n&&(s+='<p class="event__location">'+p(n)+"</p>"),s+="</article></li>"}),s+='</ul><p class="events__credit">Events feed powered by <a href="https://manchester.placecal.org/partners/geeks-for-social-change" target="_blank" rel="noopener noreferrer">PlaceCal</a></p>',l.innerHTML=s,f("events")}function y(e){var t;e&&e.length&&(t=new Date((new Date).getTime()+24*r*60*60*1e3),(e=e.filter(function(e){return new Date(e.startDate)<=t})).sort(function(e,t){return new Date(e.startDate)-new Date(t.startDate)}),e.length)?m(e):f("empty")}u&&(e=u.getAttribute("data-placecal-partner-id"),r=parseInt(u.getAttribute("data-placecal-future-days"),10)||90,t=u.getAttribute("data-placecal-endpoint"),n=u.querySelector(".gh-events-loading"),a=u.querySelector(".gh-events-error"),o=u.querySelector(".gh-events-empty"),l=u.querySelector(".gh-events-list"),s="placecal_events_v3_"+(e||"all"),i=18e5,f("loading"),e?(u=(()=>{try{var e,t=localStorage.getItem(s);return t?(e=JSON.parse(t),(new Date).getTime()-e.timestamp>i?(localStorage.removeItem(s),null):e.events):null}catch(e){return null}})())?y(u):(u=t+"?query="+encodeURIComponent("{ partner(id: "+e+") { events { id name summary description startDate endDate repeatFrequency publisherUrl onlineEventUrl onlineEventUrlType address { streetAddress postalCode addressLocality } } } }"),(c=new XMLHttpRequest).open("GET",u,!0),c.onreadystatechange=function(){if(4===c.readyState)if(200!==c.status)f("error");else try{var e=JSON.parse(c.responseText),t=e.data&&e.data.partner&&e.data.partner.events,r=t;try{localStorage.setItem(s,JSON.stringify({timestamp:(new Date).getTime(),events:r}))}catch(e){}y(t)}catch(e){f("error")}},c.onerror=function(){f("error")},c.send()):f("error"))})();//# sourceMappingURL=placecal-events.min.js.map
